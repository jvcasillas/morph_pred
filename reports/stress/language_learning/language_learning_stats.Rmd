---
author: 
  - name          : "Nuria Sagarra"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Cristina Lozano-Argüelles"
    affiliation   : "1"
  - name          : "Joseph V. Casillas"
    affilitation  : "1"

affiliation:
  - id            : "1"
    institution   : "Rutgers University"



keywords          : ""
wordcount         : ""

bibliography      : ["r-references.bib"]

floatsintext      : yes
figurelist        : yes
tablelist         : yes
footnotelist      : yes
linenumbers       : yes
mask              : yes
draft             : yes

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_word
---

```{r setup, include = FALSE}
library("papaja")
library("officer")
library("flextable")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r, 'source-scripts-models'}
source(here::here("scripts", "02_load_data.R"))

# Get path to saved models
gca_mods_path  <- here("models", "stress", "s3_adv_int_nat", 
                       "eye_track", "gca")

# Load models as list and store full mod to global env
load(paste0(gca_mods_path, "/full_mods_lang_learn.Rdata"))
load(paste0(gca_mods_path, "/ind_mods_wm.Rdata"))
load(paste0(gca_mods_path, "/nested_model_comparisons_wm.Rdata"))
load(paste0(gca_mods_path, "/model_preds_wm.Rdata"))

gca_wm_coda_mod_int_3 <- full_mods_lang_learn$gca_wm_coda_mod_int_3

```






# Language learning article (stress and working memory with natives, late advanced learners and interpreters)












# Plots

```{r, 'plot-ind-preds', echo=FALSE, fig.cap="Growth curve estimates of target fixations as a function of lexical stress and syllable structure and working memory for each group during the analysis window. Lines represent model estimates at -1, 0, and 1 standard deviations of working memory. The transparent ribbons represents ±SE. Empirical logit values on the y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The thick horizontal white line represents the 50% probability of fixating on the target. The thick vertical white line indicates 200 ms after the offset of the target syllable."}
knitr::include_graphics(
  here("figs", "stress", "s3_adv_int_nat", "eye_track", "lang_learn", 
  "stress_p1.png")
)
```

```{r, 'plot-group-preds', echo=FALSE, fig.cap="Growth curve estimates of target fixations as a function of lexical stress and syllable structure for each group during the analysis window. Symbols and lines represent model estimates at mean working memory, and the transparent ribbons represents ±SE. Empirical logit values on the y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The thick horizontal white line represents the 50% probability of fixating on the target. The thick vertical white line indicates 200 ms after the offset of the target syllable."}
knitr::include_graphics(
  here("figs", "stress", "s3_adv_int_nat", "eye_track", "lang_learn", 
  "stress_p2.png")
)
```













# Tables 

## Model estimates at target syllable offset  


```{r, table-target-offset-props, eval=T, echo=F}

border_1 <- fp_border(width = 1.5)
border_2 <- fp_border(width = 0.75)

model_preds_wm$target_offset_wm_preds %>% 
  mutate(coda = if_else(coda == 1, "CV", "CVC"), 
         cond = if_else(cond == 1, "Paroxytone", "Oxytone")) %>% 
  filter(wm == 0) %>% 
  group_by(group, coda, cond) %>% 
  summarize(prob = mean(prob), prob_lb = mean(prob_lb), prob_ub = mean(prob_ub)) %>% 
  ungroup() %>% 
  arrange(group, coda, desc(cond)) %>% 
  mutate(group = blank_same_as_last(as.character(group)), 
         coda =  blank_same_as_last(coda)) %>% 
  select(Group = group, `Lexical stress` = cond, 
         `Syllable structure` = coda, Probability = prob, LB = prob_lb, 
         UB = prob_ub) %>% 
  flextable() %>% 
  width(., j = c(2, 3, 4), width = c(1.1, 1.3, 1.1)) %>% 
  font(., fontname = "Times", part = "all") %>%
  fontsize(., size = 11) %>% 
  border_remove(.) %>%  
  border(., part = "header", 
            border.top = border_1,
            border.bottom = border_2) %>% 
  hline_bottom(., part = "body", border = border_1)
```

*Table 1*: Model estimates at mean working memory for probability of target fixations ±SE at 200 ms after the target syllable offset.




## Fixed effects

```{r, warning=F, eval=T}

pretty_fixed_effects <- gca_wm_coda_mod_int_3 %>% 
  tidy_lme4 %>% 
  #tibble::rownames_to_column("old_index") %>% 
  #arrange(index) %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:3, 0), paste0(0:3, 1), 
          paste0(0:3, 2), paste0(0:3, 3), 
          paste0(0:3, 4), paste0(0:3, 5), 
          paste0(0:3, 6), paste0(0:3, 7))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

pretty_fixed_effects %>% 
  select(-effect) %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 

```

Appendix 1: Growth curve model fixed effects






## Random effects

```{r, 'ranef-table', results = "asis", eval=T}
ranef_table <- gca_wm_coda_mod_int_3 %>% 
  tidy_ranef_summary %>% 
  # Format the numbers
  mutate_each(funs(format_fixef_num), vcov, sdcor) %>%
  mutate_each(funs(format_cor), -var1, -grp, -vcov, -sdcor) %>%
  sort_ranef_grps %>%
  # Format variable names and group names
  mutate(var1 = fix_param_names(var1) %>% blank_nas,
         grp =  blank_same_as_last(grp) %>% fix_param_names) %>% 
  rename(Group = grp, Parameter = var1, Variance = vcov, SD = sdcor)

# Correlation columns need names with characters so that pandoc can align them
names(ranef_table)[5:10] <- 
  c("Correlations", "&nbsp;", " &nbsp;", "  &nbsp;", "  &nbsp;", "  &nbsp;")

ranef_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("llrrrrrr"))
```

Appendix 2: Growth curve model random effects













# Statistical Analysis

